# 一、kronecker/vec

## 1. vec 定义

对于矩阵 $A \in \mathbb{R}^{m \times n}$，定义
$$
\ A
= \begin{bmatrix}
a_{11} & a_{12} & \cdots & a_{1n} \\
a_{21} & a_{22} & \cdots & a_{2n} \\
\vdots & \vdots & \ddots & \vdots \\
a_{m1} & a_{m2} & \cdots & a_{mn}
\end{bmatrix} \in \mathbb{R}^{m \times n}, \
\mathrm{vec}(A) 
= \begin{bmatrix}
a_{11} \\ a_{21} \\ \vdots \\ a_{m1} \\
a_{m2} \\ \vdots \\ a_{mn}
\end{bmatrix} \in \mathbb{R}^{mn}
$$

## 2. vec 两个恒等式

$$
\mathrm{vec}(AXB) = (B^\top \otimes A) \, \mathrm{vec}(X)
$$
$$
\mathrm{vec}(dY) = (\frac{\partial \mathrm{vec}(Y)}{\partial \mathrm{vec}(X)})^\top \mathrm{vec}(dX)
$$
- A, B既可以是矩阵，也可以是向量，只要维度最终符合

## 3. vec 链式法则
设 $L = Y(X)$，则有

$$
\mathrm{vec}\!\left(\frac{\partial L}{\partial X}\right)
= \frac{\partial \, \mathrm{vec}(Y)}{\partial \, \mathrm{vec}(X)}\
\mathrm{vec}\!\left(\frac{\partial L}{\partial Y}\right)
$$

## 4. kronecker 性质 

$$
(A \otimes B)^\top = (A^\top \otimes B^\top)
$$

---

# 二、求导的一般步骤

1. **写出微分 $dY$**：  
   将矩阵函数 $Y(X)$ 的增量表示出来。

2. **应用 vec 恒等式**：  
   如果 $dY$ 中出现乘法，例如 $A \, dX \, B$，则用  
   $$
   \mathrm{vec}(A \, dX \, B) = (B^\top \otimes A) \, \mathrm{vec}(dX)
   $$

3. **读出雅可比矩阵**：  
   $\mathrm{vec}(dY) = (\cdots) \mathrm{vec}(dX)$ 中的系数就是雅可比。

---