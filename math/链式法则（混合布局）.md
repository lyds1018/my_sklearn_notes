
## 1. 布局定义

| 符号                                                                              | 含义         | 布局   |
| ------------------------------------------------------------------------------- | ---------- | ---- |
| $$\mathbf{x}^{(k)}$$                                                            | 第 k 层向量    | 列向量  |
| $$J^{(k)} = \frac{\partial \mathbf{x}^{(k)}}{\partial \mathbf{x}^{(k-1)\top}}$$ | 第 k 层雅可比矩阵 | 分子布局 |
| $$\nabla_{\mathbf{x}^{(k)}} L = \frac{\partial L}{\partial \mathbf{x}^{(k)}}$$  | 损失对第 k 层梯度 | 分母布局 |

## 2️. 链式法则（反向传播）

初始梯度：
$$
\nabla_{\mathbf{x}^{(L)}} L = \frac{\partial L}{\partial \mathbf{x}^{(L)}} \quad (\text{列向量})
$$

递推公式：
$$
\nabla_{\mathbf{x}^{(k-1)}} L = \left( J^{(k)} \right)^\top \nabla_{\mathbf{x}^{(k)}} L
= \left( \frac{\partial \mathbf{x}^{(k)}}{\partial \mathbf{x}^{(k-1)\top}} \right)^\top \nabla_{\mathbf{x}^{(k)}} L
$$

- 雅可比使用 **分子布局**  
- 梯度使用 **分母布局（列向量）**  

