
# 一. 记号说明  

- 标量函数：$f(\mathbf{x}) \in \mathbb{R}$  
- 向量函数：$\mathbf{f}(\mathbf{x}) = [f_1, f_2, \dots, f_m]^\top \in \mathbb{R}^{m \times 1}$ 
- 向量：$\mathbf{x} \in \mathbb{R}^{n \times 1}$（列向量），其转置为 $\mathbf{x}^\top \in \mathbb{R}^{1 \times n}$  

---

# 二. 标量函数的向量求导  

## 1. 分子布局法 (Denominator Layout)

定义：

$$
\frac{\partial f}{\partial \mathbf{x}^\top} 
= \begin{bmatrix}
\frac{\partial f}{\partial x_1} &
\frac{\partial f}{\partial x_2} &
\cdots &
\frac{\partial f}{\partial x_n}
\end{bmatrix}
\in \mathbb{R}^{1 \times n}
$$

## 2. 分母布局法 (Numerator Layout)

定义：

$$
\frac{\partial {f}^\top}{\partial \mathbf{x}}
= \frac{\partial f}{\partial \mathbf{x}}
= \begin{bmatrix}
\frac{\partial f}{\partial x_1} \\
\frac{\partial f}{\partial x_2} \\
\vdots \\
\frac{\partial f}{\partial x_n}
\end{bmatrix}
\in \mathbb{R}^{n \times 1}
$$

# 三. 向量函数的雅可比矩阵

## 1. **分子布局 (m×n Jacobian)**

$$
J 
=\frac{\partial \mathbf{f}}{\partial \mathbf{x}^\top}
=
\begin{bmatrix}
\frac{\partial f_1}{\partial x_1} & \cdots & \frac{\partial f_1}{\partial x_n} \\
\frac{\partial f_2}{\partial x_1} & \cdots & \frac{\partial f_2}{\partial x_n} \\
\vdots & \ddots & \vdots \\
\frac{\partial f_m}{\partial x_1} & \cdots & \frac{\partial f_m}{\partial x_n}
\end{bmatrix}
\in \mathbb{R}^{m \times n}
$$

## 2. **分母布局 (n×m Jacobian)**

$$
J
=\frac{\partial \mathbf{f}^\top}{\partial \mathbf{x}}
=
\begin{bmatrix}
\frac{\partial f_1}{\partial x_1} & \cdots & \frac{\partial f_m}{\partial x_1} \\
\frac{\partial f_1}{\partial x_2} & \cdots & \frac{\partial f_m}{\partial x_2} \\
\vdots & \ddots & \vdots \\
\frac{\partial f_1}{\partial x_n} & \cdots & \frac{\partial f_m}{\partial x_n}
\end{bmatrix}
\in \mathbb{R}^{n \times m}
$$
## 3. 二者关系

$$
\frac{\partial \mathbf{y}}{\partial \mathbf{x}^T}
=
\left( \frac{\partial \mathbf{y}^T}{\partial \mathbf{x}} \right)^T
$$

---

# 四. 链式法则（符号对齐）

设  

$$
z = \mathbf f(\mathbf{y}), \quad \mathbf{y} = \mathbf g(\mathbf{x})
$$

- **分母布局：**

$$
\frac{\partial z}{\partial \mathbf{x}}
=
\frac{\partial \mathbf{y}^\top}{\partial \mathbf{x}}
\cdot
\frac{\partial {z}^\top}{\partial \mathbf{y}}
=
\frac{\partial \mathbf{y}^\top}{\partial \mathbf{x}}
\cdot
\frac{\partial z}{\partial \mathbf{y}}

$$
- **分子布局：**
$$
\frac{\partial z}{\partial \mathbf{x}^\top}
=
\frac{\partial z}{\partial \mathbf{y}^\top}
\cdot
\frac{\partial \mathbf{y}}{\partial \mathbf{x}^\top}
$$

---

# 五. 总结

## 1. 符号

| 内容      | 分子布局                                                                                                                                               | 分母布局                                                                                                                                         |
| ------- | -------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| 标量函数梯度  | $$\frac{\partial f}{\partial \mathbf{x}^\top}$$                                                                                                    | $$\frac{\partial {f}^\top}{\partial \mathbf{x}}= \frac{\partial f}{\partial \mathbf{x}}$$                                                    |
| 向量函数雅可比 | $$\frac{\partial \mathbf{f}}{\partial \mathbf{x}^\top}$$                                                                                           | $$\frac{\partial \mathbf{f}^\top}{\partial \mathbf{x}}$$                                                                                     |
| 链式法则    | $$\frac{\partial z}{\partial \mathbf{x}^\top} = \frac{\partial z}{\partial \mathbf{y}^\top} \frac{\partial \mathbf{y}}{\partial \mathbf{x}^\top}$$ | $$\frac{\partial z}{\partial \mathbf{x}} = \frac{\partial \mathbf{y}^\top}{\partial \mathbf{x}}\cdot\frac{\partial z}{\partial \mathbf{y}}$$ |

## 2. 维度

| 因变量 \ 自变量            | $\mathbf{x} \ (n,1)$（分子布局）                                      | $\mathbf{x} \ (n,1)$（分母布局）                                   |
| -------------------- | --------------------------------------------------------------- | ------------------------------------------------------------ |
| $f \ (1,)$           | $\dfrac{\partial f}{\partial \mathbf{x}^\top}$ $(1,n)$          | $\dfrac{\partial {f}^\top}{\partial \mathbf{x}}$ $(n,1)$     |
| $\mathbf{f} \ (m,1)$ | $\dfrac{\partial \mathbf{f}}{\partial \mathbf{x}^\top}$ $(m,n)$ | $\dfrac{\partial \mathbf{f}^T}{\partial \mathbf{x}}$ $(n,m)$ |



