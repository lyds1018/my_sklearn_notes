
## 1. 拉取NVIDIA官网 TensorFlow 镜像

```bash
docker pull nvcr.io/nvidia/tensorflow:24.08-tf2-py3
```
- [GPU-Tensorflow | NVIDIA NGC]([GPU-optimized AI, Machine Learning, & HPC Software | NVIDIA NGC](https://catalog.ngc.nvidia.com/orgs/nvidia/containers/tensorflow/tags?version=25.02-tf2-py3-igpu))

## 2. 运行镜像并挂载本地目录

```powershell
docker run --gpus all --ipc=host --ulimit memlock=-1 --ulimit stack=67108864 -it nvcr.io/nvidia/tensorflow:24.08-tf2-py3 bash
```

参数说明：
- `--gpus all` ：让容器使用所有可用 GPU  
- `--ipc=host` ：共享主机的进程间通信（适合深度学习）  
- `--ulimit memlock=-1` & `--ulimit stack=67108864` ：防止内存限制问题  
- `-it` ：交互模式 + 终端  

## 3. 在容器中安装额外库和组件

进入容器后（你会看到类似 `root@xxxxx:/workspace#` 提示符）：

```bash
# 更新包管理器
apt update && apt upgrade -y

# 安装常用工具
apt install -y git vim wget unzip

# 安装 Python 依赖库（示例）
pip install --upgrade pip
# 一次性安装
pip install -r requirements.txt
# 或单独安装
pip install numpy matplotlib pandas jupyterlab
```

如果需要 **系统级依赖**（如 OpenCV 依赖的库），可以：
```bash
apt install -y libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev ffmpeg
```

依赖说明：
- `libgl1-mesa-glx` → 提供 OpenGL 渲染支持（imshow 等需要）
- `libglib2.0-0` → GTK 依赖，防止 `libglib` 错误
- `libsm6`, `libxext6`, `libxrender-dev` → X11 相关依赖
- `ffmpeg` → 视频编解码支持（cv2.VideoCapture 读取 mp4, avi 等）

## 4. 保存当前容器为新镜像

首先查看容器 ID（在主机终端执行）：
```bash
exit
docker ps
```

假设容器 ID 是 `abc123456789`，执行：
```bash
docker commit abc123456789 tfgpu:v1
```

这样会生成一个新的镜像：
- 名称：`my-tf-gpu`
- 版本：`v1`

## 5. 使用新镜像运行

```powershell
docker run --gpus all --ipc=host --ulimit memlock=-1 --ulimit stack=67108864 -v D:/ScikitLearn:/workspace -it tfgpu:v1
```
